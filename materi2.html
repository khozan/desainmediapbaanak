<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Materi 2: Karakteristik Anak - Media PBA Anak</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                        display: ['Fredoka', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            light: '#818cf8',
                            DEFAULT: '#4f46e5',
                            dark: '#3730a3',
                        },
                        game: {
                            yellow: '#fbbf24',
                            orange: '#f59e0b',
                            green: '#10b981',
                            red: '#ef4444',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-image: url("https://img.freepik.com/free-vector/hand-drawn-education-pattern-background_23-2149453715.jpg?w=1380&t=st=1709123456~exp=1709124056~hmac=abcdef");
            background-color: #f3f4f6;
            background-blend-mode: overlay;
            background-attachment: fixed;
            background-size: cover;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        .option-label { cursor: pointer; transition: all 0.2s ease; }
        .option-input:checked + .option-label {
            background-color: #eff6ff;
            border-color: #4f46e5;
            color: #3730a3;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.1);
            transform: translateY(-2px);
        }
        .option-input:checked + .option-label .circle-check {
            background-color: #4f46e5;
            border-color: #4f46e5;
        }
        .option-input:checked + .option-label .circle-check::after {
            content: '✔'; color: white; font-size: 10px; display: flex; align-items: center; justify-content: center;
        }

        /* Timer Animation */
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }
        .timer-warning {
            animation: pulse-red 1s infinite;
            background-color: #fee2e2 !important;
            color: #b91c1c !important;
            border-color: #b91c1c !important;
        }
    </style>
</head>
<body class="antialiased text-gray-800 min-h-screen flex flex-col">

    <!-- NAVBAR -->
    <nav class="sticky top-0 z-50 glass-panel border-b border-white/40">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <a href="index.html" class="flex items-center gap-2 text-gray-600 hover:text-brand transition font-bold">
                    <i class="fa-solid fa-arrow-left"></i> Kembali
                </a>
                <div class="text-center">
                    <h1 class="font-display font-bold text-lg text-brand-dark hidden md:block">Karakteristik Anak & Implikasi Desain</h1>
                    <span class="text-xs font-bold bg-green-100 text-green-600 px-2 py-0.5 rounded-full">Level 2</span>
                </div>
                <div class="flex items-center gap-2">
                    <span id="user-name" class="text-xs font-bold text-gray-500 hidden sm:block">Loading...</span>
                    <div class="w-8 h-8 rounded-full bg-brand/20 flex items-center justify-center text-brand">
                        <i class="fa-solid fa-user"></i>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- CONTENT -->
    <main class="flex-grow w-full max-w-4xl mx-auto p-4 md:p-6 pb-20 space-y-8">

        <!-- HEADER MATERI -->
        <div class="glass-panel p-8 rounded-3xl relative overflow-hidden text-center">
            <div class="absolute -top-10 -left-10 w-40 h-40 bg-green-500/10 rounded-full blur-2xl"></div>
            <div class="absolute bottom-10 right-10 w-40 h-40 bg-brand/10 rounded-full blur-2xl"></div>
            
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-green-500 text-white text-3xl mb-4 shadow-lg transform -rotate-6">
                <i class="fa-solid fa-child-reaching"></i>
            </div>
            <h2 class="font-display font-bold text-3xl text-gray-800 mb-2">Karakteristik Anak</h2>
            <p class="text-gray-500">Implikasi pada Desain Media Pembelajaran Bahasa Arab</p>
        </div>

        <!-- ISI MATERI -->
        <article class="space-y-6">
            
            <!-- A. Pendahuluan -->
            <div class="glass-panel p-6 rounded-2xl">
                <h3 class="font-bold text-xl text-brand mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-lightbulb"></i> Pendahuluan Konseptual
                </h3>
                <p class="mb-4 leading-relaxed text-gray-700 text-justify">
                    Pembelajaran Bahasa Arab pada anak tidak dapat dilepaskan dari karakteristik perkembangan kognitif, sosial, emosional, serta kondisi kesejahteraan psikologis mereka. Penelitian menunjukkan bahwa media memiliki pengaruh signifikan terhadap perkembangan anak (Lemish, 2013; Mares & Kretz, 2015).
                </p>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg text-sm text-gray-700 italic">
                    "Desain media pembelajaran Bahasa Arab harus berbasis pada pemahaman komprehensif mengenai karakteristik anak agar efektif secara pedagogis dan aman secara psikologis."
                </div>
            </div>

            <!-- B. Karakteristik Kognitif -->
            <div class="glass-panel p-6 rounded-2xl">
                <h3 class="font-bold text-xl text-blue-600 mb-6 border-b pb-2">Karakteristik Kognitif Anak</h3>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-blue-50 p-4 rounded-xl">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fa-solid fa-cube text-blue-500"></i>
                            <h4 class="font-bold text-gray-800">Berpikir Konkret</h4>
                        </div>
                        <p class="text-xs text-gray-600 mb-2">Anak memahami konsep melalui visual nyata.</p>
                        <p class="text-xs font-bold text-brand">Implikasi: Gunakan ilustrasi benda nyata (misal: gambar rumah untuk "بيت").</p>
                    </div>

                    <div class="bg-blue-50 p-4 rounded-xl">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fa-solid fa-hourglass-half text-blue-500"></i>
                            <h4 class="font-bold text-gray-800">Perhatian Terbatas</h4>
                        </div>
                        <p class="text-xs text-gray-600 mb-2">Durasi fokus anak pendek.</p>
                        <p class="text-xs font-bold text-brand">Implikasi: Modul singkat (microlearning) & variasi aktivitas.</p>
                    </div>

                    <div class="bg-blue-50 p-4 rounded-xl">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fa-solid fa-eye text-blue-500"></i>
                            <h4 class="font-bold text-gray-800">Dominasi Visual</h4>
                        </div>
                        <p class="text-xs text-gray-600 mb-2">Informasi visual lebih mudah diproses.</p>
                        <p class="text-xs font-bold text-brand">Implikasi: Teks dan gambar berdekatan (kontiguitas).</p>
                    </div>

                    <div class="bg-blue-50 p-4 rounded-xl">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fa-solid fa-gamepad text-blue-500"></i>
                            <h4 class="font-bold text-gray-800">Belajar via Bermain</h4>
                        </div>
                        <p class="text-xs text-gray-600 mb-2">Efektif saat dikemas sebagai permainan.</p>
                        <p class="text-xs font-bold text-brand">Implikasi: Gamifikasi (poin, kuis, badge).</p>
                    </div>
                </div>
            </div>

            <!-- Visual Section -->
            <div class="glass-panel p-6 rounded-2xl text-center">
                <h3 class="font-bold text-lg text-gray-800 mb-4">Dunia Imajinasi & Belajar Anak</h3>
                <div class="relative overflow-hidden rounded-xl shadow-lg group">
                    <img src="https://img.freepik.com/free-vector/happy-children-studying-classroom_74855-5852.jpg" alt="Anak Belajar" class="w-full h-auto object-contain transform group-hover:scale-105 transition duration-500">
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                        <p class="text-white text-sm font-bold">Interaksi Sosial & Eksplorasi dalam Pembelajaran</p>
                    </div>
                </div>
            </div>

            <!-- C. Psikologis & Sosial -->
            <div class="glass-panel p-6 rounded-2xl">
                <h3 class="font-bold text-xl text-pink-500 mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-heart"></i> Psikologis & Sosial
                </h3>
                <ul class="space-y-4 text-sm text-gray-700">
                    <li class="bg-white p-3 rounded-lg border-l-4 border-pink-400 shadow-sm">
                        <b>Hubungan Parasosial:</b> Anak bisa berteman dengan karakter media. <br>
                        <i class="fa-solid fa-arrow-right text-pink-400 text-xs"></i> Gunakan maskot karakter tetap sebagai "teman belajar".
                    </li>
                    <li class="bg-white p-3 rounded-lg border-l-4 border-pink-400 shadow-sm">
                        <b>Eksplorasi Tinggi:</b> Rasa ingin tahu yang besar. <br>
                        <i class="fa-solid fa-arrow-right text-pink-400 text-xs"></i> Fitur klik objek untuk bunyi, level rahasia.
                    </li>
                    <li class="bg-white p-3 rounded-lg border-l-4 border-pink-400 shadow-sm">
                        <b>Butuh Apresiasi:</b> Penguatan positif. <br>
                        <i class="fa-solid fa-arrow-right text-pink-400 text-xs"></i> Feedback suara "Mumtaz!", animasi bintang.
                    </li>
                </ul>
            </div>

            <!-- D & E. Kesehatan & Orang Tua -->
            <div class="grid md:grid-cols-2 gap-6">
                <div class="glass-panel p-5 rounded-2xl border-t-4 border-red-400">
                    <h4 class="font-bold text-gray-800 mb-2"><i class="fa-solid fa-user-doctor text-red-500"></i> Kesehatan</h4>
                    <p class="text-xs text-gray-600 text-justify">
                        Penggunaan media berlebih memicu gangguan tidur & kecemasan. <br>
                        <b>Solusi:</b> Batasi durasi, sisipkan aktivitas fisik.
                    </p>
                </div>
                <div class="glass-panel p-5 rounded-2xl border-t-4 border-purple-400">
                    <h4 class="font-bold text-gray-800 mb-2"><i class="fa-solid fa-hands-holding-child text-purple-500"></i> Peran Orang Tua</h4>
                    <p class="text-xs text-gray-600 text-justify">
                        Penting untuk mendampingi & literasi media. <br>
                        <b>Solusi:</b> Sediakan dashboard monitoring untuk orang tua.
                    </p>
                </div>
            </div>

            <!-- G. Tabel Ringkasan (Responsive Table) -->
            <div class="glass-panel p-6 rounded-2xl overflow-x-auto">
                <h3 class="font-bold text-lg text-gray-800 mb-4">Ringkasan Implikasi Desain</h3>
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-100 text-gray-700 uppercase font-bold">
                        <tr>
                            <th class="p-3 rounded-l-lg">Aspek</th>
                            <th class="p-3">Karakteristik</th>
                            <th class="p-3 rounded-r-lg">Implikasi Desain</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <tr>
                            <td class="p-3 font-bold text-blue-600">Kognitif</td>
                            <td class="p-3">Berpikir Konkret</td>
                            <td class="p-3">Gambar nyata & animasi tindakan</td>
                        </tr>
                        <tr>
                            <td class="p-3 font-bold text-blue-600">Visual</td>
                            <td class="p-3">Dominasi Visual</td>
                            <td class="p-3">Integrasi Teks-Gambar-Audio</td>
                        </tr>
                        <tr>
                            <td class="p-3 font-bold text-pink-500">Sosial</td>
                            <td class="p-3">Hubungan Parasosial</td>
                            <td class="p-3">Gunakan maskot pembelajaran</td>
                        </tr>
                        <tr>
                            <td class="p-3 font-bold text-red-500">Kesehatan</td>
                            <td class="p-3">Risiko Overuse</td>
                            <td class="p-3">Batasi durasi & desain seimbang</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Referensi Accordion -->
            <details class="glass-panel p-4 rounded-xl group">
                <summary class="flex justify-between items-center font-bold text-gray-600 cursor-pointer list-none">
                    <span><i class="fa-solid fa-book mr-2"></i> Referensi Akademik</span>
                    <span class="transition group-open:rotate-180"><i class="fa-solid fa-chevron-down"></i></span>
                </summary>
                <div class="text-xs text-gray-500 mt-4 space-y-2 pl-4 border-l-2 border-gray-300">
                    <p>Lemish, D. (2013). The Routledge International Handbook of Children, Adolescents and Media.</p>
                    <p>Fisch, S.M. (2017). Bridging Theory and Practice: Applying Cognitive Theory to Educational Media.</p>
                    <p>Calvert, S.L. (2017). Parasocial Relationships With Media Characters.</p>
                    <p>Mares, M.-L., & Kretz, V. (2015). Media Effects on Children.</p>
                    <p>Jordan, A. (2004). The role of media in children's development.</p>
                </div>
            </details>

        </article>

        <!-- QUIZ GAME SECTION -->
        <section id="quiz-section" class="mt-12 relative">
            
            <!-- START PANEL -->
            <div id="start-panel" class="glass-panel p-10 rounded-3xl text-center shadow-2xl transform transition hover:scale-[1.02] duration-300 relative overflow-hidden border-2 border-white/50">
                <div class="absolute inset-0 bg-gradient-to-br from-green-500/5 to-brand/5 z-0"></div>
                <div class="relative z-10 flex flex-col items-center">
                    <div class="w-24 h-24 bg-green-500 rounded-full flex items-center justify-center mb-6 shadow-lg shadow-green-200 animate-bounce">
                        <i class="fa-solid fa-puzzle-piece text-4xl text-white"></i>
                    </div>
                    <h2 class="font-display font-bold text-3xl text-gray-800 mb-2">Tantangan Materi 2</h2>
                    <div class="flex items-center gap-4 text-sm text-gray-500 font-bold mb-8 bg-white/50 px-4 py-2 rounded-full">
                        <span><i class="fa-regular fa-clock text-red-500"></i> 15 Menit</span>
                        <span>•</span>
                        <span><i class="fa-solid fa-list-check text-blue-500"></i> 20 Soal</span>
                        <span>•</span>
                        <span><i class="fa-solid fa-trophy text-yellow-500"></i> Min. 80</span>
                    </div>
                    <button onclick="startQuiz()" class="bg-gradient-to-r from-green-500 to-green-700 hover:from-green-400 hover:to-green-600 text-white font-bold py-4 px-12 rounded-2xl shadow-xl shadow-green-500/30 text-lg transition transform active:scale-95 flex items-center gap-3">
                        <span>Mulai Sekarang</span> <i class="fa-solid fa-rocket"></i>
                    </button>
                </div>
            </div>

            <!-- TIMER STICKY -->
            <div id="timer-display" class="hidden fixed top-20 right-4 md:right-10 z-40 bg-white/90 backdrop-blur border-2 border-brand text-brand-dark px-5 py-2 rounded-full font-mono font-bold shadow-lg flex items-center gap-2 transform scale-110">
                <i class="fa-regular fa-clock animate-pulse"></i> <span id="time-left" class="text-lg">15:00</span>
            </div>

            <!-- QUIZ FORM -->
            <form id="quiz-form" onsubmit="event.preventDefault(); submitQuiz();" class="hidden space-y-6 mt-6">
                <div id="questions-container" class="space-y-6"></div>

                <div class="glass-panel p-6 rounded-2xl sticky bottom-4 z-40 border-t-4 border-green-500 shadow-2xl">
                    <div class="flex justify-between items-center">
                        <div class="text-sm font-bold text-gray-600">
                            Terjawab: <span id="answered-count" class="text-green-600 text-lg">0</span>/20
                        </div>
                        <button type="submit" id="btn-submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transform active:scale-95 transition flex items-center gap-2">
                            <span>Kirim Jawaban</span> <i class="fa-solid fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </form>
        </section>

    </main>

    <!-- FOOTER -->
    <footer class="bg-white border-t py-6 mt-10">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <p class="font-display font-bold text-gray-400 text-sm">© 2024 Desain Pengembangan Media Ajar Bahasa Arab.</p>
        </div>
    </footer>

    <!-- LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
        import { getFirestore, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA-jHdi3VVu9F5i6tLIjGJCcVFfHBieqbI",
            authDomain: "desain-mediapba-anak.firebaseapp.com",
            projectId: "desain-mediapba-anak",
            storageBucket: "desain-mediapba-anak.firebasestorage.app",
            messagingSenderId: "118347735703",
            appId: "1:118347735703:web:bafeb4590ddbe85f7c7fd2",
            measurementId: "G-RN0S3X8V27"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let quizInterval;
        let timeRemaining = 15 * 60; 

        // SOAL MATERI 2 (20 SOAL)
        const quizData = [
            { q: "Anak usia dini cenderung berpikir secara …", options: ["Abstrak", "Deduktif", "Konkret", "Hipotetis", "Analitis"], a: 2 },
            { q: "Media yang dirancang sesuai tahap perkembangan kognitif anak akan meningkatkan …", options: ["Beban kognitif", "Retensi dan pemahaman", "Kompleksitas bahasa", "Kecepatan membaca", "Ketergantungan media"], a: 1 },
            { q: "Salah satu risiko penggunaan media berlebihan pada anak adalah …", options: ["Peningkatan fokus", "Percepatan bahasa", "Gangguan tidur", "Perluasan kosakata otomatis", "Peningkatan empati"], a: 2 },
            { q: "Hubungan emosional anak dengan karakter media disebut …", options: ["Relasi kognitif", "Hubungan struktural", "Hubungan parasosial", "Ikatan formal", "Relasi behavioristik"], a: 2 },
            { q: "Mengapa gambar konkret penting dalam pembelajaran Bahasa Arab untuk anak?", options: ["Agar media terlihat modern", "Karena anak berpikir simbolik kompleks", "Karena anak memahami konsep melalui representasi nyata", "Untuk mengurangi biaya produksi", "Agar materi lebih panjang"], a: 2 },
            { q: "Rentang perhatian anak yang terbatas menuntut desain media yang …", options: ["Penuh teks panjang", "Berisi teori tata bahasa detail", "Interaktif dan berdurasi singkat", "Tanpa variasi aktivitas", "Menggunakan satu warna saja"], a: 2 },
            { q: "Konten prososial dalam media akan berdampak pada …", options: ["Penurunan konsentrasi", "Perkembangan empati dan pemahaman sosial", "Gangguan bahasa", "Ketergantungan digital", "Penurunan motivasi"], a: 1 },
            { q: "Sistem reward seperti badge dan bintang dalam aplikasi bertujuan untuk …", options: ["Menambah durasi layar", "Memberikan hukuman", "Memenuhi kebutuhan apresiasi anak", "Mengurangi interaksi", "Menggantikan guru"], a: 2 },
            { q: "Untuk mengajarkan kosakata 'بيت', desain yang paling tepat adalah …", options: ["Definisi panjang tanpa gambar", "Ilustrasi rumah + audio pengucapan", "Penjelasan tata bahasa", "Latihan esai", "Tabel morfologi"], a: 1 },
            { q: "Guru ingin meningkatkan eksplorasi siswa. Fitur yang paling tepat adalah …", options: ["Teks statis", "Video pasif", "Objek interaktif yang dapat diklik untuk mendengar kosakata", "PDF panjang", "Latihan hafalan tanpa konteks"], a: 2 },
            { q: "Untuk mengurangi dampak negatif penggunaan media, desain sebaiknya …", options: ["Tanpa batas waktu", "Memasukkan pengingat durasi penggunaan", "Menambah animasi cepat", "Menghilangkan evaluasi", "Menghapus peran guru"], a: 1 },
            { q: "Dalam mengajarkan fi‘l (kata kerja), pendekatan terbaik adalah …", options: ["Menjelaskan teori nahwu panjang", "Menyajikan tabel konjugasi lengkap", "Menampilkan animasi tindakan sesuai makna kata", "Memberikan soal esai", "Menggunakan teks monokrom"], a: 2 },
            { q: "Sebuah aplikasi menggunakan warna terlalu mencolok dan animasi berlebihan sehingga anak sulit fokus. Masalah utama desain tersebut adalah …", options: ["Kurang interaktif", "Beban kognitif berlebih", "Kurang gamifikasi", "Minim teknologi", "Terlalu sederhana"], a: 1 },
            { q: "Media hanya menyajikan tata bahasa abstrak tanpa konteks visual. Berdasarkan karakteristik anak, kelemahan utamanya adalah …", options: ["Terlalu konkret", "Tidak sesuai dengan tahap berpikir konkret", "Terlalu interaktif", "Terlalu emosional", "Terlalu singkat"], a: 1 },
            { q: "Jika anak menunjukkan kecemasan setelah menggunakan aplikasi dengan karakter menakutkan, maka desain tersebut gagal mempertimbangkan aspek …", options: ["Tipografi", "Visual branding", "Perkembangan emosional", "Gamifikasi", "Durasi modul"], a: 2 },
            { q: "Aplikasi tanpa keterlibatan orang tua berisiko …", options: ["Lebih mandiri", "Lebih murah", "Minim supervisi dan kontrol penggunaan", "Lebih adaptif", "Lebih komunikatif"], a: 2 },
            { q: "Manakah desain yang paling sesuai dengan karakteristik kognitif dan psikologis anak?", options: ["Teks panjang + teori abstrak", "Ilustrasi konkret + audio + aktivitas interaktif + reward", "Video pasif tanpa interaksi", "Tabel tata bahasa kompleks", "Latihan esai panjang"], a: 1 },
            { q: "Jika sebuah aplikasi meningkatkan kosakata tetapi menyebabkan anak sulit tidur karena penggunaan berlebihan, maka secara pedagogis aplikasi tersebut …", options: ["Sepenuhnya efektif", "Layak tanpa revisi", "Perlu evaluasi keseimbangan kesehatan dan pembelajaran", "Tidak relevan", "Harus dihapus total"], a: 2 },
            { q: "Media yang menampilkan karakter tetap sebagai “teman belajar” Bahasa Arab memiliki keunggulan karena …", options: ["Mengurangi biaya produksi", "Meningkatkan hubungan parasosial yang mendukung pembelajaran", "Mengurangi eksplorasi", "Mempercepat penyelesaian materi", "Menggantikan guru sepenuhnya"], a: 1 },
            { q: "Secara komprehensif, desain media pembelajaran Bahasa Arab yang ideal bagi anak harus …", options: ["Fokus pada estetika visual saja", "Mengutamakan teknologi tinggi", "Mengintegrasikan aspek kognitif, emosional, sosial, kesehatan, dan supervisi orang tua", "Mengurangi interaktivitas", "Menghindari evaluasi"], a: 2 }
        ];

        // RENDER SOAL
        const renderQuiz = () => {
            const container = document.getElementById('questions-container');
            let html = '';

            quizData.forEach((item, index) => {
                let optionsHtml = '';
                item.options.forEach((opt, optIndex) => {
                    optionsHtml += `
                        <div class="relative">
                            <input type="radio" name="q${index}" value="${optIndex}" id="q${index}_${optIndex}" class="option-input peer sr-only" onchange="window.updateProgress()">
                            <label for="q${index}_${optIndex}" class="option-label flex items-center p-4 bg-white border border-gray-200 rounded-xl hover:bg-gray-50 peer-focus:ring-2 peer-focus:ring-green-500 peer-focus:ring-offset-2">
                                <div class="circle-check w-5 h-5 border-2 border-gray-300 rounded-full mr-3 flex-shrink-0 transition-colors"></div>
                                <span class="text-sm font-medium text-gray-700">${opt}</span>
                            </label>
                        </div>
                    `;
                });

                html += `
                    <div class="glass-panel p-6 rounded-2xl animate-fade-in-up" style="animation-delay: ${index * 0.05}s">
                        <div class="flex items-start gap-3 mb-4">
                            <span class="bg-green-100 text-green-600 font-bold px-2 py-1 rounded text-xs">No. ${index + 1}</span>
                            <p class="font-bold text-gray-800 text-base">${item.q}</p>
                        </div>
                        <div class="space-y-3">
                            ${optionsHtml}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        };

        // START
        window.startQuiz = () => {
            document.getElementById('start-panel').classList.add('hidden');
            document.getElementById('quiz-form').classList.remove('hidden');
            document.getElementById('timer-display').classList.remove('hidden');
            document.getElementById('timer-display').scrollIntoView({ behavior: 'smooth' });

            quizInterval = setInterval(() => {
                timeRemaining--;
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                document.getElementById('time-left').innerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (timeRemaining <= 300) document.getElementById('timer-display').classList.add('timer-warning');
                if (timeRemaining <= 0) {
                    clearInterval(quizInterval);
                    Swal.fire({ title: 'Waktu Habis!', text: 'Dikirim otomatis.', icon: 'info', timer: 2000, showConfirmButton: false }).then(() => window.submitQuiz());
                }
            }, 1000);
        };

        window.updateProgress = () => {
            const answered = document.querySelectorAll('input[type="radio"]:checked').length;
            document.getElementById('answered-count').innerText = answered;
        };

        // SUBMIT
        window.submitQuiz = async () => {
            if(quizInterval) clearInterval(quizInterval);
            const btn = document.getElementById('btn-submit');
            const answered = document.querySelectorAll('input[type="radio"]:checked').length;
            
            if (timeRemaining > 0 && answered < quizData.length) {
                Swal.fire({
                    title: 'Belum Selesai',
                    text: `Baru menjawab ${answered}/${quizData.length}. Yakin kirim?`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Ya, Kirim',
                    cancelButtonText: 'Lanjut'
                }).then((result) => {
                    if (result.isConfirmed) processScore();
                    else {
                        quizInterval = setInterval(() => {
                            timeRemaining--;
                            // Resume timer logic simplificated
                        }, 1000);
                    }
                });
                return;
            }
            processScore();
        };

        const processScore = async () => {
            const btn = document.getElementById('btn-submit');
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Menilai...';

            let correct = 0;
            quizData.forEach((item, index) => {
                const selectedEl = document.querySelector(`input[name="q${index}"]:checked`);
                if (selectedEl && parseInt(selectedEl.value) === item.a) correct++;
            });

            const score = Math.round((correct / quizData.length) * 100);

            try {
                if (currentUser) {
                    const userRef = doc(db, "users", currentUser.uid);
                    await updateDoc(userRef, { "scores.2": score }); // Save to score 2

                    if (score >= 80) {
                        confetti({ particleCount: 200, spread: 90, origin: { y: 0.6 } });
                        await Swal.fire({
                            title: 'Luar Biasa!',
                            html: `Nilai: <span class="text-5xl font-bold text-green-600 block my-4">${score}</span>Materi selanjutnya terbuka!`,
                            icon: 'success',
                            confirmButtonText: 'Ke Dashboard',
                            confirmButtonColor: '#4f46e5'
                        });
                    } else {
                        await Swal.fire({
                            title: 'Belum Lulus',
                            html: `Nilai: <span class="text-5xl font-bold text-red-500 block my-4">${score}</span>Butuh 80 untuk lulus.`,
                            icon: 'error',
                            confirmButtonText: 'Coba Lagi',
                            confirmButtonColor: '#f59e0b'
                        });
                    }
                    window.location.href = 'index.html';
                }
            } catch (error) {
                Swal.fire('Error', error.message, 'error');
                btn.disabled = false;
                btn.innerText = 'Kirim Jawaban';
            }
        };

        // INIT
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                const docSnap = await getDoc(doc(db, "users", user.uid));
                if (docSnap.exists()) {
                    document.getElementById('user-name').innerText = docSnap.data().name;
                }
                renderQuiz();
            } else {
                Swal.fire({
                    title: 'Sesi Tidak Ditemukan',
                    text: 'Silakan login kembali.',
                    icon: 'warning',
                    confirmButtonText: 'Login',
                    allowOutsideClick: false
                }).then(() => { window.location.href = 'index.html'; });
            }
        });
    </script>
</body>
</html>